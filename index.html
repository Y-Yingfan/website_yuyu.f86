<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>旅游人生選物代購｜Select Shop</title>
  <!-- LINE LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#f5f3ef;
      --panel:#ffffff;
      --ink:#2f2f2f;
      --muted:#6b6a62;
      --line:#e6e2da;
      --accent:#c2a35d;
      --good:#2c7a47;
      --warn:#a05b00;
      --shadow:0 10px 28px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",sans-serif}
    .wrap{max-width:1060px;margin:0 auto;padding:18px}
    .gate{max-width:720px;margin:24px auto 0;padding:14px;background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);text-align:center}
    .gate h2{margin:6px 0 8px}
    .gate p{color:var(--muted);margin:6px 0}
    .gate .btns{display:flex;gap:10px;justify-content:center;margin-top:10px}
    .btn{padding:10px 14px;border:1px solid var(--line);border-radius:999px;background:var(--panel);cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border:none}
    .cta{position:fixed;left:0;right:0;bottom:0;background:#fffaf0;border-top:1px solid var(--line);padding:10px 12px;display:flex;gap:10px;align-items:center;justify-content:center}
    .cta a{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;color:#2f2f2f;text-decoration:none}
    .cta a.primary{background:var(--accent);color:#fff;border:none}
    .toast{position:fixed;left:50%;bottom:84px;transform:translateX(-50%);background:#111;color:#fff;padding:8px 12px;border-radius:10px;font-size:14px;opacity:0;pointer-events:none;transition:opacity .2s}
    .toast.show{opacity:1}
    /* ===== Order Modal ===== */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.35);padding:16px;z-index:999}
    .modal.show{display:flex}
    .modal .panel{max-width:420px;width:100%;background:#fff;border-radius:14px;
      padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .modal .panel h3{margin:0 0 6px}
    .modal .panel p{margin:6px 0 12px;color:var(--muted)}
    .modal .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .btn.outline{background:#fff;border:1px solid var(--line)}
    .linkbtn{background:none;border:none;color:var(--muted);margin-top:8px;cursor:pointer}
  </style>
</head>
<body>
  <!-- ===== CONFIG ===== -->
  <script>
    const LIFF_ID = '2008022206-rqDnER1B';
    const OA_LINK = 'https://line.me/R/ti/p/@958xfkot';
    const SUPABASE_URL = 'https://yuyu.f86.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_fLryqSfqfQW5c8SD6umiJA_2YfoAthB';
    const DEV_MODE = false;
  </script>

  <!-- Gate -->
  <div id="gateLogin" class="gate">
    <h2>登入 LINE 後開始逛</h2>
    <p>為了提供客服與出貨通知，請先以 LINE 登入。</p>
    <div class="btns">
      <button class="btn primary" id="btnLineLogin">以 LINE 登入</button>
    </div>
  </div>
  <div id="gateFriend" class="gate hide">
    <h2>加入官方帳號後繼續</h2>
    <p>加入好友即可接收訂單進度、補貨通知與優惠。</p>
    <div class="btns">
      <a class="btn primary" id="btnAddFriend" target="_blank">加入 LINE 好友</a>
      <button class="btn" id="btnCheckFriend">我已加入，重新確認</button>
    </div>
  </div>

  <!-- Sticky CTA -->
  <div class="cta hide" id="shopCta">
    <a class="primary" id="ctaOrder" href="#">立即私訊下單</a>
    <a id="ctaCopy">複製下單格式</a>
  </div>

  <!-- 彈窗 -->
  <div class="modal" id="orderModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="panel">
      <h3>選擇聯絡方式</h3>
      <p>下單系統還在開發中，要麻煩先用社群或是官方 LINE 私訊我 🧡</p>
      <div class="grid2">
        <div>
          <strong>社群</strong>
          <p class="muted">密碼：<b>0628</b></p>
          <a class="btn outline" href="https://line.me/ti/g2/fRmTHOkmCy8ite62TzDencHTqlruXj6um0DT7g" target="_blank" rel="noopener">前往社群</a>
        </div>
        <div>
          <strong>官方 LINE</strong>
          <p class="muted">加入好友後私訊下單</p>
          <a class="btn outline" href="https://line.me/R/ti/p/@958xfkot" target="_blank" rel="noopener">加入官方帳號</a>
        </div>
      </div>
      <button class="linkbtn" id="btnCloseModal">關閉</button>
    </div>
  </div>

  <div class="toast" id="toast">已複製，下單訊息貼上即可 ✨</div>

  <script>
    // ===== Supabase Init =====
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== LIFF Init =====
    async function initLiff(){
      try{
        await liff.init({ liffId: LIFF_ID });
        if(!liff.isLoggedIn()){
          document.getElementById('gateLogin').classList.remove('hide');
          return;
        }
        document.getElementById('gateLogin').classList.add('hide');
        await checkFriendship();
      }catch(e){
        console.error('LIFF init error', e);
        if(DEV_MODE){ await bootShop(); return; }
        document.getElementById('gateLogin').classList.remove('hide');
      }
    }

    async function checkFriendship(){
      try{
        const res = await liff.getFriendship();
        if(res.friendFlag){
          document.getElementById('gateFriend').classList.add('hide');
          await bootShop();
        }else{
          document.getElementById('gateFriend').classList.remove('hide');
        }
      }catch(e){
        console.warn('getFriendship error', e);
        document.getElementById('gateFriend').classList.remove('hide');
      }
    }

    document.getElementById('btnLineLogin').addEventListener('click',()=>{
      if(!liff.isLoggedIn()) liff.login();
    });
    document.getElementById('btnAddFriend').setAttribute('href', OA_LINK);
    document.getElementById('btnCheckFriend').addEventListener('click', checkFriendship);

    async function bootShop(){
      document.getElementById('shopCta').classList.remove('hide');
    }

    // ===== 彈窗事件 =====
    const ctaOrder = document.getElementById('ctaOrder');
    const orderModal = document.getElementById('orderModal');
    const btnCloseModal = document.getElementById('btnCloseModal');

    ctaOrder.addEventListener('click', (e) => {
      e.preventDefault();
      orderModal.classList.add('show');
      orderModal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    });

    btnCloseModal.addEventListener('click', () => {
      orderModal.classList.remove('show');
      orderModal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    });

    orderModal.addEventListener('click', (e) => {
      if (e.target === orderModal) {
        orderModal.classList.remove('show');
        orderModal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }
    });

    // ===== 啟動 =====
    if(DEV_MODE){ bootShop(); } else { initLiff(); }
  </script>
</body>
</html>
