<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>後台｜連線與商品管理</title>
<style>
:root{--bg:#f7f3ef;--paper:#fffdf9;--card:#fff;--ink:#2b2b2b;--muted:#7a7267;--brand:#8B5E34;--border:#eadfcd;--shadow:0 10px 24px rgba(139,94,52,.08);--radius:14px;--maxw:1080px}
*{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#f8f5f1 0%,var(--bg) 100%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",Arial}
.wrap{max-width:var(--maxw);margin:20px auto;padding:0 16px}
h1{margin:6px 0 14px}.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.tabbtn{border:1px solid var(--border);background:#fffdf9;border-radius:999px;padding:8px 14px;cursor:pointer}
.tabbtn.active{background:var(--brand);color:#fff;border-color:transparent}
.panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;margin-bottom:14px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media (max-width:860px){.row{grid-template-columns:1fr}}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fffdfa}
textarea{min-height:72px}.btn{border:none;background:var(--brand);color:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
.btn.ghost{background:#fff;border:1px solid var(--border);color:var(--ink)}
.list{width:100%;border-collapse:collapse}.list th,.list td{border-top:1px solid var(--border);padding:8px;vertical-align:top}
.list th{background:#fffaf2;text-align:left;font-weight:700}
.muted{color:var(--muted)}.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.badge{display:inline-block;border:1px solid var(--border);padding:3px 8px;border-radius:999px;font-size:12px;background:#fff}
.actions{display:flex;gap:6px}
.inline{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:#fff}
.hr{height:1px;background:var(--border);margin:10px 0}
.small{font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>後台｜連線與商品管理 <span class="badge">Supabase</span></h1>

  <div class="tabs">
    <button class="tabbtn active" data-tab="runs">Runs</button>
    <button class="tabbtn" data-tab="products">Products</button>
    <button class="tabbtn" data-tab="bulk">Bulk Move</button>
  </div>

  <!-- Runs -->
  <section id="tab-runs">
    <div class="panel">
      <h3 style="margin:0 0 10px">新增連線（精簡 & 自動對欄位）</h3>
      <div class="row">
        <div>
          <label>地區 region（選填）</label>
          <select id="runRegion">
            <option value="">—</option><option>Japan</option><option>Korea</option><option>Taiwan</option><option>Other</option>
          </select>
        </div>
        <div>
          <label>連線名稱 title（也會帶入商品 eta_text）</label>
          <input id="runTitle" placeholder="例：9/6-9 日本連線"/>
        </div>
        <div><label>開始日 start_date（選填）</label><input id="runStart" type="date"/></div>
        <div><label>結束日 end_date（選填）</label><input id="runEnd" type="date"/></div>
        <div><label>寄送開始日 ship_start_date（選填）</label><input id="runShipStart" type="date"/></div>
        <div><label>代碼 code（選填）</label><input id="runCode" placeholder="自訂代碼（可空白）"/></div>
        <div style="grid-column:1 / -1"><label>備註 note（選填）</label><input id="runNote" placeholder="例：9/10 依序出貨"/></div>
        <div><label>是否啟用 is_active</label><select id="runActive"><option value="true">true</option><option value="false">false</option></select></div>
        <div><label>是否首頁 is_featured</label><select id="runFeatured"><option value="true">true</option><option value="false" selected>false</option></select></div>
      </div>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn" id="btnCreateRun">新增連線</button>
        <span class="muted small">送出時自動忽略你表裡不存在的欄位。</span>
      </div>
    </div>

    <div class="panel">
      <h3 style="margin:0 0 10px">所有連線（可編輯 / 刪除）</h3>
      <table class="list" id="runsTable">
        <thead><tr>
          <th style="width:26%">標題 / 代碼</th>
          <th style="width:9%">區域</th>
          <th style="width:18%">日期</th>
          <th style="width:12%">寄送</th>
          <th>備註</th>
          <th style="width:6%">狀態</th>
          <th style="width:5%">首頁</th>
          <th style="width:16%">操作</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Products -->
  <section id="tab-products" style="display:none">
    <div class="panel">
      <h3 style="margin:0 0 10px">新增商品（與 CSV 對齊，並可指派到連線）</h3>
      <div class="row">
        <div><label>名稱 name</label><input id="pName" placeholder="商品名稱"/></div>
        <div><label>售價 price（NT$）</label><input id="pPrice" type="number" step="1" min="0"/></div>
        <div><label>分類 category</label><input id="pCategory" placeholder="3 coins"/></div>
        <div>
          <label>商品編號 product_id（留空自動產生）</label>
          <input id="pPid" placeholder="留空 → 自動產生 PYYYYMMDD-XXX"/>
        </div>
        <div><label>狀態 status</label><input id="pStatus" placeholder="現貨/預購/缺貨…"/></div>
        <div><label>到貨日 arrival_time</label><input id="pArrival" placeholder="例：9/10 依序出貨"/></div>
        <div>
          <label>指派到連線（會同步 eta_text）</label>
          <select id="pRunAssign"><option value="">— 選擇連線 —</option></select>
        </div>
        <div><label>eta_text（若上面沒選，手動填）</label><input id="pEta" placeholder="例：9/6-9 日本連線"/></div>
        <div style="grid-column:1 / -1"><label>備註 / 補充 note</label><input id="pNote"/></div>
        <div><label>標籤 tags（逗號分隔）</label><input id="pTags" placeholder="3coins,and us,腮紅"/></div>
        <div><label>代表圖 img_url</label><input id="pImgUrl" placeholder="Japan/3 coins/xxx.jpg 或 https://..."/></div>
      </div>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn" id="btnCreateProduct">新增商品</button>
        <span class="muted small">送出後會自動建立 <code>product_runs</code> 對應。</span>
      </div>
    </div>

    <div class="panel">
      <h3 style="margin:0 0 10px">已新增（最新 50，可編輯）</h3>
      <table class="list" id="productsTable">
        <thead><tr>
          <th>名稱</th><th style="width:90px">售價</th><th style="width:130px">分類</th>
          <th style="width:150px">編號</th><th style="width:220px">連線 / eta_text</th><th style="width:170px">操作</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Bulk Move -->
  <section id="tab-bulk" style="display:none">
    <div class="panel">
      <h3 style="margin:0 0 10px">批次移動／複製商品到另一個連線</h3>
      <div class="row">
        <div>
          <label>來源連線</label>
          <select id="bmSrc"><option value="">— 選擇連線 —</option></select>
        </div>
        <div>
          <label>目標連線</label>
          <select id="bmDst"><option value="">— 選擇連線 —</option></select>
        </div>
        <div>
          <label>模式</label>
          <select id="bmMode">
            <option value="reassign">移動（改指派到目標連線）</option>
            <option value="clone">複製（建立新商品並指派）</option>
          </select>
        </div>
        <div>
          <label>範圍</label>
          <select id="bmScope">
            <option value="linked">只含已有關聯的商品（product_runs）</option>
            <option value="includeEta">若無關聯則用 eta_text 補齊</option>
          </select>
        </div>
      </div>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn" id="btnBulkPreview">預覽數量</button>
        <button class="btn" id="btnBulkRun">執行</button>
        <span id="bmInfo" class="muted small"></span>
      </div>
      <div class="hr"></div>
      <p class="muted small">「複製」會為每個新商品自動產生新的 <code>product_id</code>（PYYYYMMDD-XXX），其餘欄位沿用來源。</p>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl='https://llbpmqyjigovxixeohzr.supabase.co';
const supabaseKey='sb_publishable_fLryqSfqfQW5c8SD6umiJA_2YfoAthB';
const sb=supabase.createClient(supabaseUrl,supabaseKey);

// Tabs
document.querySelectorAll('.tabbtn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('section[id^="tab-"]').forEach(s=>s.style.display='none');
    document.getElementById('tab-'+btn.dataset.tab).style.display='block';
  };
});

// helpers
const safeGet=(o,k,def='')=>o&&o[k]!=null?o[k]:def;
const parseTags=(s)=>{const raw=(s||'').trim();return raw?raw.split(',').map(x=>x.trim()).filter(Boolean):null};

// tolerant insert/update that drops unknown columns / type errors
async function tolerantWrite(table, payload, mode='insert', match=undefined){
  let p={}; Object.entries(payload).forEach(([k,v])=>{ if(v!=='' && v!==undefined) p[k]=v; });
  for(let i=0;i<10;i++){
    let q = sb.from(table);
    if(mode==='insert') q=q.insert(p).select();
    else if(mode==='update'){ q=q.update(p); if(match) q=q.match(match); q=q.select(); }
    else if(mode==='delete'){ return sb.from(table).delete().match(match); }
    const { data, error } = await q;
    if(!error) return {data};
    const msg=(error.message||'').toLowerCase();
    const m = msg.match(/column\s+([a-z0-9_]+)\s+.*does not exist/);
    if(m && p[m[1]]!==undefined){ delete p[m[1]]; continue; }
    if(msg.includes('tags')){ delete p['tags']; continue; }
    return {error};
  }
  return {error:{message:'重試超過次數'}};
}

// === RUNS ===
let runsCache=[];

async function loadRuns(){
  const { data, error } = await sb.from('runs').select('*').order('created_at',{ascending:false}).order('id',{ascending:false});
  if(error){ alert('讀取 runs 失敗：'+error.message); return; }
  runsCache = data||[];

  // 商品指派 / BulkMove 下拉
  const assign=document.getElementById('pRunAssign');
  const bmSrc=document.getElementById('bmSrc');
  const bmDst=document.getElementById('bmDst');
  [assign,bmSrc,bmDst].forEach(sel=>{ sel.innerHTML='<option value="">— 選擇連線 —</option>'; });
  runsCache.forEach(r=>{
    const text=r.title || r.code || r.region || ('Run#'+r.id);
    [assign,bmSrc,bmDst].forEach(sel=>{
      const o=document.createElement('option');
      o.value=JSON.stringify({id:r.id,title:r.title||'',note:r.note||''});
      o.textContent=text; sel.appendChild(o);
    });
  });

  // 列表
  const tb=document.querySelector('#runsTable tbody'); tb.innerHTML='';
  runsCache.forEach(r=>{
    const tr=document.createElement('tr');
    tr.dataset.id=r.id;
    tr.innerHTML = `
      <td><div><input class="inline f-title" value="${safeGet(r,'title','')}" /></div>
          <div class="muted"><input class="inline f-code" value="${safeGet(r,'code','')}"/></div></td>
      <td><input class="inline f-region" value="${safeGet(r,'region','')}"/></td>
      <td>
        <input class="inline f-start" type="date" value="${safeGet(r,'start_date','')||''}"/>
        <div class="muted" style="margin-top:4px">～</div>
        <input class="inline f-end" type="date" value="${safeGet(r,'end_date','')||''}"/>
      </td>
      <td><input class="inline f-ship" type="date" value="${safeGet(r,'ship_start_date','')||''}"/></td>
      <td><input class="inline f-note" value="${safeGet(r,'note','')}"/></td>
      <td><select class="inline f-active"><option value="true" ${safeGet(r,'is_active',true)?'selected':''}>啟用</option><option value="false" ${!safeGet(r,'is_active',true)?'selected':''}>停用</option></select></td>
      <td><select class="inline f-featured"><option value="true" ${safeGet(r,'is_featured',false)?'selected':''}>✔︎</option><option value="false" ${!safeGet(r,'is_featured',false)?'selected':''}>—</option></select></td>
      <td class="actions">
        <button class="btn ghost btnSave">儲存</button>
        <button class="btn ghost btnReload">取消</button>
        <button class="btn btnDelete">刪除</button>
      </td>`;
    tb.appendChild(tr);
  });
}

document.getElementById('btnCreateRun').onclick=async()=>{
  const payload={
    title:(runTitle.value||'').trim(),
    region:(runRegion.value||'').trim()||null,
    start_date: runStart.value || null,
    end_date: runEnd.value || null,
    ship_start_date: runShipStart.value || null,
    code:(runCode.value||'').trim()||null,
    note:(runNote.value||'').trim()||null,
    is_active: runActive.value==='true',
    is_featured: runFeatured.value==='true'
  };
  if(!payload.title){ alert('請輸入連線名稱（title）'); return; }
  const res = await tolerantWrite('runs', payload, 'insert');
  if(res.error){ alert('新增失敗：'+res.error.message); return; }
  alert('新增成功'); ['runTitle','runRegion','runStart','runEnd','runShipStart','runCode','runNote'].forEach(id=>document.getElementById(id).value='');
  await loadRuns();
};

document.querySelector('#runsTable').addEventListener('click', async (e)=>{
  const tr = e.target.closest('tr'); if(!tr) return;
  const id = tr.dataset.id;
  if(e.target.classList.contains('btnReload')){ loadRuns(); return; }
  if(e.target.classList.contains('btnSave')){
    const payload={
      title: tr.querySelector('.f-title').value.trim(),
      code: tr.querySelector('.f-code').value.trim()||null,
      region: tr.querySelector('.f-region').value.trim()||null,
      start_date: tr.querySelector('.f-start').value||null,
      end_date: tr.querySelector('.f-end').value||null,
      ship_start_date: tr.querySelector('.f-ship').value||null,
      note: tr.querySelector('.f-note').value.trim()||null,
      is_active: tr.querySelector('.f-active').value==='true',
      is_featured: tr.querySelector('.f-featured').value==='true'
    };
    if(!payload.title){ alert('標題不可空白'); return; }
    const res = await tolerantWrite('runs', payload, 'update', {id});
    if(res.error){ alert('儲存失敗：'+res.error.message); return; }
    alert('已儲存'); loadRuns(); return;
  }
  if(e.target.classList.contains('btnDelete')){
    if(!confirm('確定要刪除這個連線？（不可復原）')) return;
    const { error } = await sb.from('runs').delete().match({id});
    if(error){ alert('刪除失敗：'+error.message); return; }
    alert('已刪除'); loadRuns(); return;
  }
});

// === PRODUCTS ===

// 自動產生商品編號：PYYYYMMDD-XXX
async function genNextPid(){
  const d=new Date();
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
  const prefix=`P${y}${m}${day}-`;
  // 抓同日前綴的最大尾碼
  const { data, error } = await sb.from('products').select('product_id').ilike('product_id', `${prefix}%`).order('product_id',{ascending:false}).limit(1);
  let seq=1;
  if(!error && data && data[0] && data[0].product_id){
    const last=data[0].product_id;
    const n = parseInt(String(last).split('-').pop().replace(/\D/g,''),10);
    if(!isNaN(n)) seq = n+1;
  }
  return prefix + String(seq).padStart(3,'0');
}

async function loadProducts(){
  const { data, error } = await sb.from('products').select('id,name,price,category,product_id,eta_text').order('created_at',{ascending:false}).limit(50);
  if(error){ console.error(error); return; }
  const tb=document.querySelector('#productsTable tbody'); tb.innerHTML='';
  (data||[]).forEach(p=>{
    const tr=document.createElement('tr'); tr.dataset.id=p.id;
    const runSel = buildRunSelect(p.eta_text);
    tr.innerHTML=`
      <td><input class="inline ep-name" value="${p.name||''}"/></td>
      <td><input class="inline ep-price" type="number" value="${p.price??''}"/></td>
      <td><input class="inline ep-cat" value="${p.category||''}"/></td>
      <td><input class="inline ep-pid" value="${p.product_id||''}" placeholder="留空自動產生"/></td>
      <td>${runSel}<div style="margin-top:6px"><input class="inline ep-eta" value="${p.eta_text||''}" placeholder="eta_text（若不選連線）"/></div></td>
      <td class="actions">
        <button class="btn ghost ep-save">儲存</button>
        <button class="btn ghost ep-reload">取消</button>
        <button class="btn ep-del">刪除</button>
      </td>`;
    tb.appendChild(tr);
  });
}
function buildRunSelect(currentEta){
  const sel = document.createElement('select');
  sel.className='inline ep-run';
  const opt0=document.createElement('option'); opt0.value=''; opt0.textContent='— 指派連線 —'; sel.appendChild(opt0);
  runsCache.forEach(r=>{
    const o=document.createElement('option');
    o.value=JSON.stringify({id:r.id,title:r.title||''});
    o.textContent=r.title||r.code||r.region||('Run#'+r.id);
    if(r.title===currentEta) o.selected=true;
    sel.appendChild(o);
  });
  return sel.outerHTML;
}

document.getElementById('pRunAssign').addEventListener('change', e=>{
  const v=e.target.value; if(!v) return;
  try{ const obj=JSON.parse(v); if(obj.title) document.getElementById('pEta').value=obj.title; if(obj.note){ const cur=pNote.value||''; pNote.value=cur? (cur+'；'+obj.note):obj.note; } }catch(_){}
});

document.getElementById('btnCreateProduct').onclick=async()=>{
  // 先編號
  let pid=(pPid.value||'').trim();
  if(!pid){ pid=await genNextPid(); }

  // run 指派
  let runObj=null; try{ runObj = JSON.parse(pRunAssign.value||''); }catch(_){}
  const eta = (pEta.value||'').trim() || (runObj?.title||null);

  const payload={
    name:(pName.value||'').trim(),
    price: pPrice.value? Number(pPrice.value): null,
    category:(pCategory.value||'').trim()||null,
    product_id: pid,
    status:(pStatus.value||'').trim()||null,
    arrival_time:(pArrival.value||'').trim()||null,
    eta_text: eta,
    note:(pNote.value||'').trim()||null,
    img_url:(pImgUrl.value||'').trim()||null,
    tags: parseTags(pTags.value)
  };
  if(!payload.name){ alert('請輸入商品名稱'); return; }

  const ins = await tolerantWrite('products', payload, 'insert');
  if(ins.error){ alert('新增商品失敗：'+ins.error.message); return; }
  const product = ins.data?.[0];

  if(runObj?.id && product?.id){
    await sb.from('product_runs').delete().match({product_id: product.id}); // 確保單一指派
    const { error } = await sb.from('product_runs').insert({ product_id: product.id, run_id: runObj.id });
    if(error){ console.warn('建立 product_runs 失敗（不影響商品建立）：', error.message); }
  }

  alert('新增商品成功');
  ['pName','pPrice','pCategory','pPid','pStatus','pArrival','pEta','pNote','pImgUrl','pTags'].forEach(id=>document.getElementById(id).value='');
  await loadProducts();
};

// 產品列操作
document.querySelector('#productsTable').addEventListener('click', async (e)=>{
  const tr=e.target.closest('tr'); if(!tr) return; const id=tr.dataset.id;
  if(e.target.classList.contains('ep-reload')){ loadProducts(); return; }
  if(e.target.classList.contains('ep-del')){
    if(!confirm('確定刪除這個商品？')) return;
    const { error } = await sb.from('products').delete().match({id});
    if(!error){ alert('已刪除'); loadProducts(); } else { alert('刪除失敗：'+error.message); }
    return;
  }
  if(e.target.classList.contains('ep-save')){
    // 若編號留空 → 自動產生
    let pid = tr.querySelector('.ep-pid').value.trim();
    if(!pid) pid = await genNextPid();

    // run 選單
    let runObj=null; try{ runObj=JSON.parse(tr.querySelector('.ep-run').value||''); }catch(_){}
    const eta = tr.querySelector('.ep-eta').value.trim() || (runObj?.title||null);

    const payload={
      name: tr.querySelector('.ep-name').value.trim(),
      price: tr.querySelector('.ep-price').value ? Number(tr.querySelector('.ep-price').value) : null,
      category: tr.querySelector('.ep-cat').value.trim()||null,
      product_id: pid,
      eta_text: eta
    };
    if(!payload.name){ alert('名稱不可空白'); return; }
    const res = await tolerantWrite('products', payload, 'update', {id});
    if(res.error){ alert('儲存失敗：'+res.error.message); return; }

    // 維護 product_runs 對應
    if(runObj?.id){
      await sb.from('product_runs').delete().match({product_id:id});
      await sb.from('product_runs').insert({product_id:id, run_id: runObj.id});
    }

    alert('已儲存'); loadProducts(); return;
  }
});

// === BULK MOVE ===
async function getProductsByRun(runId, includeEta=false){
  // 先取 product_runs
  const { data: pr } = await sb.from('product_runs').select('product_id').match({run_id:runId});
  let ids=new Set((pr||[]).map(x=>x.product_id));
  // 如果要補 eta_text
  let etaTitle=null; if(includeEta){
    const run = runsCache.find(r=>r.id===runId);
    etaTitle = run?.title||null;
    if(etaTitle){
      const { data: etaProds } = await sb.from('products').select('id').eq('eta_text', etaTitle);
      (etaProds||[]).forEach(p=>ids.add(p.id));
    }
  }
  if(ids.size===0) return [];
  const { data: products } = await sb.from('products').select('*').in('id', Array.from(ids));
  return products||[];
}

async function cloneProductToRun(p, dstRun){
  const newPid = await genNextPid();
  const payload = {
    name:p.name, price:p.price, category:p.category,
    product_id:newPid, status:p.status, arrival_time:p.arrival_time,
    eta_text: dstRun.title||null, note:p.note, img_url:p.img_url,
    tags:p.tags
  };
  const ins = await tolerantWrite('products', payload, 'insert');
  if(ins.error) return {error:ins.error};
  const np = ins.data?.[0];
  if(np?.id){
    await sb.from('product_runs').insert({product_id:np.id, run_id:dstRun.id});
  }
  return {ok:true};
}

document.getElementById('btnBulkPreview').onclick=async()=>{
  const src = JSON.parse(document.getElementById('bmSrc').value||'null');
  const scope = document.getElementById('bmScope').value;
  if(!src){ alert('請選來源連線'); return; }
  const list = await getProductsByRun(src.id, scope==='includeEta');
  document.getElementById('bmInfo').textContent = `將處理 ${list.length} 筆商品。`;
};

document.getElementById('btnBulkRun').onclick=async()=>{
  const src = JSON.parse(document.getElementById('bmSrc').value||'null');
  const dst = JSON.parse(document.getElementById('bmDst').value||'null');
  const mode = document.getElementById('bmMode').value;
  const scope = document.getElementById('bmScope').value;
  if(!src || !dst){ alert('請選來源與目標連線'); return; }
  if(src.id===dst.id){ alert('來源與目標不可相同'); return; }

  const list = await getProductsByRun(src.id, scope==='includeEta');
  if(list.length===0){ alert('沒有可處理的商品'); return; }

  if(mode==='reassign'){
    // 改指派到目標 run & 同步 eta_text
    const eta = dst.title||null;
    for(const p of list){
      await tolerantWrite('products', {eta_text:eta}, 'update', {id:p.id});
      await sb.from('product_runs').delete().match({product_id:p.id});
      await sb.from('product_runs').insert({product_id:p.id, run_id:dst.id});
    }
    alert(`已移動 ${list.length} 筆商品到「${eta}」`);
  }else{
    // 複製
    let ok=0;
    for(const p of list){
      const r=await cloneProductToRun(p, dst);
      if(r.ok) ok++;
    }
    alert(`已複製 ${ok}/${list.length} 筆商品到「${dst.title||''}」`);
  }
  document.getElementById('bmInfo').textContent='';
  await loadProducts();
};

// init
(async function init(){
  await loadRuns();
  await loadProducts();
})();
</script>
</body>
</html>
